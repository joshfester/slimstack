!function(e){var o=!1,t=[];e(document).on("keyup",function(e){t.length&&(27==e.keyCode||27==e.DOM_VK_ESCAPE&&0==e.which)&&t[t.length-1].trigger("escPress")}),e.fn.clrchs_lightboxed=function(i){return this.each(function(){function n(){t.pop(),h.showOverlay?(p.remove(),e(window).unbind("resize",s)):h.closeClickOutside&&e(document).off("click",l),h.parentLightbox&&h.parentLightbox.fadeIn(200),h.preventScroll&&e("body").css("overflow",""),e(document).off("click",h.closeSelector,d),u.off("close",n),u.off("escPress",r),u.off("reposition",c),e(window).unbind("resize",c),e(window).unbind("scroll",c),u[h.disappearEffect](h.lightboxSpeed,function(){f()})}function s(){e(window).height()<e(document).height()?p.css({height:e(document).height()+"px"}):p.css({height:"100%"})}function c(){if(u.css({left:"50%",marginLeft:u.outerWidth()/2*-1,zIndex:o+1}),u.height()+80>=e(window).height()&&"absolute"!=u.css("position")){var t=e(document).scrollTop()+40;u.css({position:"absolute",top:t+"px",marginTop:0})}else u.height()+80<e(window).height()&&(h.centered?u.css({position:"fixed",top:"50%",marginTop:u.outerHeight()/2*-1}):u.css({position:"fixed"}).css(h.modalCSS),h.preventScroll&&e("body").css("overflow","hidden"))}function r(){h.closeEsc&&n()}function l(e){if(!u.is(e.target)&&0===u.has(e.target).length)return n(),e.preventDefault,!1}function d(e){if(u.has(e.target).length)return n(),e.preventDefault(),!1}function a(){u.trigger("lightboxedLoad"),u.off("lightboxedLoad")}function f(){u.trigger("lightboxedClose"),u.off("lightboxedClose")}var p,h=e.extend({},e.fn.clrchs_lightboxed.defaults,i),u=e(this);t.push(u),e("body").append(u.hide()),o=!1===o?h.zIndex+1:o+1,h.showOverlay?(p=e('<div class="'+h.classPrefix+'_overlay"/>'),e("body").append(p),s(),e(window).resize(s),p.css({position:"absolute",width:"100%",top:0,left:0,right:0,bottom:0,zIndex:o,display:"none"}),p.css(h.overlayCSS),p.fadeIn(h.overlaySpeed,function(){c(),u[h.appearEffect](h.lightboxSpeed,function(){a(),h.closeClickOutside&&p.click(function(e){return n(),e.preventDefault,!1})})})):(c(),u[h.appearEffect](h.lightboxSpeed,function(){u.show(),a(),h.closeClickOutside&&e(document).on("click",l)})),h.parentLightbox&&h.parentLightbox.fadeOut(200),e(window).resize(c).scroll(c),e(document).on("click",h.closeSelector,d),u.on("close",n),u.on("escPress",r),u.on("reposition",c)})},e.fn.clrchs_lightboxed.defaults={appearEffect:"fadeIn",appearEase:"",disappearEffect:"fadeOut",disappearEase:"",lightboxSpeed:200,overlaySpeed:250,closeSelector:".clrchs_lightboxed_close",closeClickOutside:!1,closeEsc:!1,showOverlay:!0,parentLightbox:!1,preventScroll:!0,centered:!1,classPrefix:"clrchs_lbx",zIndex:999999,modalCSS:{top:"40px"},overlayCSS:{background:"black",opacity:.3}}}(jQuery);